{"version":3,"file":"index.js","sources":["../src/createVirtualElement.ts","../src/hooks/useFloatingToolbar.ts","../src/utils/makeClientRect.ts","../src/utils/mergeClientRects.ts","../src/utils/getBoundingClientRect.ts","../src/utils/createVirtualRef.ts","../src/utils/getRangeBoundingClientRect.ts","../src/utils/getSelectionBoundingClientRect.ts","../src/hooks/useVirtualFloating.ts"],"sourcesContent":["import { ClientRectObject } from '@floating-ui/core';\nimport { VirtualElement } from '@floating-ui/react';\n\nexport const getDefaultBoundingClientRect = (): ClientRectObject => ({\n  width: 0,\n  height: 0,\n  x: 0,\n  y: 0,\n  top: -9999,\n  left: -9999,\n  right: 9999,\n  bottom: 9999,\n});\n\nexport const createVirtualElement = (): VirtualElement => ({\n  getBoundingClientRect: getDefaultBoundingClientRect,\n});\n","import { useEffect, useState } from 'react';\nimport {\n  getSelectionText,\n  isSelectionExpanded,\n  mergeProps,\n  useEventEditorSelectors,\n  usePlateEditorState,\n} from '@udecode/plate-common';\nimport { useFocused } from 'slate-react';\n\nimport {\n  getSelectionBoundingClientRect,\n  useVirtualFloating,\n  UseVirtualFloatingOptions,\n} from '..';\n\nexport type FloatingToolbarState = {\n  floatingOptions?: UseVirtualFloatingOptions;\n  ignoreReadOnly?: boolean;\n  hideToolbar?: boolean;\n};\n\nexport const useFloatingToolbarState = ({\n  floatingOptions,\n  hideToolbar,\n  ignoreReadOnly,\n}: FloatingToolbarState) => {\n  const editor = usePlateEditorState();\n  const focusedEditorId = useEventEditorSelectors.focus();\n  const focused = useFocused();\n\n  const [open, setOpen] = useState(false);\n  const [waitForCollapsedSelection, setWaitForCollapsedSelection] =\n    useState(false);\n\n  const selectionExpanded = editor && isSelectionExpanded(editor);\n  const selectionText = editor && getSelectionText(editor);\n\n  const floating = useVirtualFloating(\n    mergeProps(\n      {\n        getBoundingClientRect: getSelectionBoundingClientRect,\n        open,\n        onOpenChange: setOpen,\n      },\n      floatingOptions\n    )\n  );\n\n  return {\n    editor,\n    open,\n    setOpen,\n    waitForCollapsedSelection,\n    setWaitForCollapsedSelection,\n    selectionExpanded,\n    selectionText,\n    focused,\n    focusedEditorId,\n    ignoreReadOnly,\n    hideToolbar,\n    floating,\n  };\n};\n\nexport const useFloatingToolbar = ({\n  editor,\n  selectionExpanded,\n  selectionText,\n  waitForCollapsedSelection,\n  setWaitForCollapsedSelection,\n  open,\n  setOpen,\n  focused,\n  focusedEditorId,\n  floating,\n  ignoreReadOnly,\n  hideToolbar,\n}: ReturnType<typeof useFloatingToolbarState>) => {\n  // On refocus, the editor keeps the previous selection,\n  // so we need to wait it's collapsed at the new position before displaying the floating toolbar.\n  useEffect(() => {\n    if (!focused || ignoreReadOnly) {\n      setWaitForCollapsedSelection(true);\n    }\n\n    if (!selectionExpanded) {\n      setWaitForCollapsedSelection(false);\n    }\n  }, [\n    focused,\n    ignoreReadOnly,\n    selectionExpanded,\n    setWaitForCollapsedSelection,\n  ]);\n\n  useEffect(() => {\n    if (\n      !selectionExpanded ||\n      !selectionText ||\n      (!(editor.id === focusedEditorId || ignoreReadOnly) && hideToolbar)\n    ) {\n      setOpen(false);\n    } else if (\n      selectionText &&\n      selectionExpanded &&\n      !waitForCollapsedSelection\n    ) {\n      setOpen(true);\n    }\n  }, [\n    setOpen,\n    editor.id,\n    editor.selection,\n    focusedEditorId,\n    hideToolbar,\n    ignoreReadOnly,\n    selectionExpanded,\n    selectionText,\n    waitForCollapsedSelection,\n  ]);\n\n  const { update } = floating;\n\n  const selectionTextLength = selectionText?.length ?? 0;\n\n  useEffect(() => {\n    if (selectionTextLength > 0) {\n      update?.();\n    }\n  }, [selectionTextLength, update]);\n\n  return {\n    ref: floating.refs.setFloating,\n    props: {\n      style: floating.style,\n    },\n    hidden: !open,\n  };\n};\n","export const makeClientRect = ({\n  top,\n  bottom,\n  left,\n  right,\n}: {\n  top: number;\n  bottom: number;\n  left: number;\n  right: number;\n}): DOMRect => {\n  const width = right - left;\n  const height = bottom - top;\n\n  const props: Omit<DOMRect, 'toJSON'> = {\n    x: left,\n    y: top,\n    top,\n    bottom,\n    left,\n    right,\n    width,\n    height,\n  };\n\n  return {\n    ...props,\n    toJSON: () => props,\n  };\n};\n","import { makeClientRect } from './makeClientRect';\n\nexport const mergeClientRects = (clientRects: DOMRect[]): DOMRect => {\n  if (clientRects.length === 0) {\n    throw new Error('clientRects should not be empty');\n  }\n\n  return makeClientRect({\n    top: Math.min(...clientRects.map((rect) => rect.top)),\n    bottom: Math.max(...clientRects.map((rect) => rect.bottom)),\n    left: Math.min(...clientRects.map((rect) => rect.left)),\n    right: Math.max(...clientRects.map((rect) => rect.right)),\n  });\n};\n","import {\n  getRange,\n  toDOMRange,\n  TReactEditor,\n  Value,\n} from '@udecode/plate-common';\nimport { Location, Path, Range } from 'slate';\n\nimport { mergeClientRects } from './mergeClientRects';\n\nexport const getBoundingClientRect = <V extends Value>(\n  editor: TReactEditor<V>,\n  at?: Location | Location[]\n): DOMRect | undefined => {\n  const atRanges: Range[] = (() => {\n    if (!at) return [editor.selection].filter(Boolean) as Range[];\n    const atArray = Array.isArray(at) && !Path.isPath(at) ? at : [at];\n    return atArray.map((location) => getRange(editor, location));\n  })();\n\n  const clientRects = atRanges\n    .map((range) => toDOMRange(editor, range)?.getBoundingClientRect())\n    .filter(Boolean) as DOMRect[];\n  if (clientRects.length === 0) return undefined;\n  return mergeClientRects(clientRects);\n};\n","import { RefObject } from 'react';\nimport { TReactEditor, Value } from '@udecode/plate-common';\nimport { Location } from 'slate';\n\nimport { getBoundingClientRect } from './getBoundingClientRect';\n\nexport type VirtualRef = RefObject<Pick<HTMLElement, 'getBoundingClientRect'>>;\n\nexport const createVirtualRef = <V extends Value>(\n  editor: TReactEditor<V>,\n  at?: Location | Location[],\n  {\n    fallbackRect,\n  }: {\n    fallbackRect?: ClientRect;\n  } = {}\n): VirtualRef => ({\n  current: {\n    getBoundingClientRect: () => {\n      const rect = getBoundingClientRect(editor, at) || fallbackRect;\n\n      if (!rect) {\n        throw new Error(\n          'Could not get the bounding client rect of the location. Please provide a fallbackRect.'\n        );\n      }\n\n      return rect;\n    },\n  },\n});\n","import { ClientRectObject } from '@floating-ui/core';\nimport { toDOMRange, TReactEditor, Value } from '@udecode/plate-common';\nimport { Range } from 'slate';\n\nimport { getDefaultBoundingClientRect } from '../createVirtualElement';\n\n/**\n * Get bounding client rect by slate range\n */\nexport const getRangeBoundingClientRect = <V extends Value>(\n  editor: TReactEditor<V>,\n  at: Range | null\n): ClientRectObject => {\n  if (!at) return getDefaultBoundingClientRect();\n\n  const domRange = toDOMRange(editor, at);\n  if (!domRange) return getDefaultBoundingClientRect();\n\n  return domRange.getBoundingClientRect();\n};\n","import { ClientRectObject } from '@floating-ui/core';\n\nimport { getDefaultBoundingClientRect } from '../createVirtualElement';\n\n/**\n * Get bounding client rect of the window selection\n */\nexport const getSelectionBoundingClientRect = (): ClientRectObject => {\n  const domSelection = window.getSelection();\n\n  if (!domSelection || domSelection.rangeCount < 1) {\n    return getDefaultBoundingClientRect();\n  }\n\n  const domRange = domSelection.getRangeAt(0);\n\n  return domRange.getBoundingClientRect();\n};\n","import { CSSProperties, MutableRefObject, useRef, useState } from 'react';\nimport { ClientRectObject } from '@floating-ui/core';\nimport { useIsomorphicLayoutEffect } from '@udecode/plate-common';\n\nimport { createVirtualElement } from '../createVirtualElement';\nimport {\n  autoUpdate,\n  ReferenceType,\n  useFloating,\n  UseFloatingProps,\n  UseFloatingReturn,\n  VirtualElement,\n} from '../libs/floating-ui';\nimport { getSelectionBoundingClientRect } from '../utils/index';\n\nexport interface UseVirtualFloatingOptions extends Partial<UseFloatingProps> {\n  getBoundingClientRect?: () => ClientRectObject;\n  open?: boolean;\n}\n\nexport interface UseVirtualFloatingReturn<\n  RT extends ReferenceType = ReferenceType,\n> extends UseFloatingReturn<RT> {\n  virtualElementRef: MutableRefObject<VirtualElement>;\n  style: CSSProperties;\n}\n\n/**\n * `useFloating` with a controlled virtual element. Used to follow cursor position.\n *\n * Default options:\n * - `whileElementsMounted: autoUpdate`\n *\n * Additional options:\n * - `getBoundingClientRect` to get the bounding client rect.\n * - `hidden` to hide the floating element\n *\n * Additional returns:\n * - `style` to apply to the floating element\n * - `virtualElementRef`\n *\n * @see useFloating\n * @see https://floating-ui.com/docs/react-dom#virtual-element\n */\nexport const useVirtualFloating = <RT extends ReferenceType = ReferenceType>({\n  getBoundingClientRect = getSelectionBoundingClientRect,\n  ...floatingOptions\n}: UseVirtualFloatingOptions): UseVirtualFloatingReturn<RT> => {\n  const virtualElementRef = useRef<RT>(createVirtualElement() as RT);\n  const [visible, setVisible] = useState(true);\n\n  const floatingResult = useFloating<RT>({\n    // update on scroll and resize\n    whileElementsMounted: autoUpdate,\n    ...floatingOptions,\n  });\n\n  const { refs, middlewareData, strategy, x, y, update } = floatingResult;\n\n  useIsomorphicLayoutEffect(() => {\n    virtualElementRef.current.getBoundingClientRect = getBoundingClientRect;\n  }, [getBoundingClientRect, update]);\n\n  useIsomorphicLayoutEffect(() => {\n    refs.setReference(virtualElementRef.current);\n  }, [refs]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (!middlewareData?.hide) return;\n\n    const { referenceHidden } = middlewareData.hide;\n\n    setVisible(!referenceHidden);\n  }, [middlewareData.hide]);\n\n  return {\n    ...floatingResult,\n    virtualElementRef,\n    style: {\n      position: strategy,\n      top: y ?? 0,\n      left: x ?? 0,\n      display: floatingOptions.open === false ? 'none' : undefined,\n      visibility: visible ? undefined : 'hidden',\n    },\n  };\n};\n"],"names":["getDefaultBoundingClientRect","width","height","x","y","top","left","right","bottom","createVirtualElement","getBoundingClientRect","useFloatingToolbarState","floatingOptions","hideToolbar","ignoreReadOnly","editor","usePlateEditorState","focusedEditorId","useEventEditorSelectors","focus","focused","useFocused","open","setOpen","useState","waitForCollapsedSelection","setWaitForCollapsedSelection","selectionExpanded","isSelectionExpanded","selectionText","getSelectionText","floating","useVirtualFloating","mergeProps","getSelectionBoundingClientRect","onOpenChange","useFloatingToolbar","_selectionText$length","useEffect","id","selection","update","selectionTextLength","length","ref","refs","setFloating","props","style","hidden","makeClientRect","toJSON","mergeClientRects","clientRects","Error","Math","min","map","rect","max","at","atRanges","filter","Boolean","atArray","Array","isArray","Path","isPath","location","getRange","range","_toDOMRange","toDOMRange","undefined","createVirtualRef","fallbackRect","current","getRangeBoundingClientRect","domRange","domSelection","window","getSelection","rangeCount","getRangeAt","virtualElementRef","useRef","visible","setVisible","floatingResult","useFloating","whileElementsMounted","autoUpdate","middlewareData","strategy","useIsomorphicLayoutEffect","setReference","hide","referenceHidden","position","display","visibility"],"mappings":"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"}