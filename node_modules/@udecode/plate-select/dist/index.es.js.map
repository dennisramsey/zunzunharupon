{"version":3,"file":"index.es.js","sources":["../src/withSelectOnBackspace.ts","../src/createSelectOnBackspacePlugin.ts"],"sourcesContent":["import {\n  getNode,\n  getNodeEntries,\n  getNodeString,\n  getPoint,\n  getPointBefore,\n  isCollapsed,\n  PlateEditor,\n  queryNode,\n  removeNodes,\n  select,\n  Value,\n  WithPlatePlugin,\n} from '@udecode/plate-common';\nimport Slate from 'slate';\n\nimport { SelectOnBackspacePlugin } from './createSelectOnBackspacePlugin';\n\n/**\n * Set a list of element types to select on backspace\n */\nexport const withSelectOnBackspace = <\n  V extends Value = Value,\n  E extends PlateEditor<V> = PlateEditor<V>,\n>(\n  editor: E,\n  {\n    options: { query, removeNodeIfEmpty },\n  }: WithPlatePlugin<SelectOnBackspacePlugin, V, E>\n) => {\n  const { deleteBackward } = editor;\n\n  editor.deleteBackward = (unit: 'character' | 'word' | 'line' | 'block') => {\n    const { selection } = editor;\n\n    if (unit === 'character' && isCollapsed(selection)) {\n      const pointBefore = getPointBefore(editor, selection as Slate.Location, {\n        unit,\n      });\n\n      if (pointBefore) {\n        const [prevCell] = getNodeEntries(editor, {\n          match: (node) => queryNode([node, pointBefore.path], query),\n          at: pointBefore,\n        });\n\n        if (!!prevCell && pointBefore) {\n          const point = getPoint(editor, selection as Slate.Location);\n          const selectedNode = getNode(editor, point.path);\n          if (\n            removeNodeIfEmpty &&\n            selectedNode &&\n            !getNodeString(selectedNode as any)\n          ) {\n            // remove node if empty\n            removeNodes(editor);\n          }\n\n          // don't delete image, set selection there\n          select(editor, pointBefore);\n        } else {\n          deleteBackward(unit);\n        }\n      } else {\n        deleteBackward(unit);\n      }\n    } else {\n      deleteBackward(unit);\n    }\n  };\n\n  return editor;\n};\n","import { createPluginFactory, QueryNodeOptions } from '@udecode/plate-common';\n\nimport { withSelectOnBackspace } from './withSelectOnBackspace';\n\nexport type SelectOnBackspacePlugin = {\n  query?: QueryNodeOptions;\n  removeNodeIfEmpty?: boolean;\n};\n\nexport const KEY_SELECT_ON_BACKSPACE = 'selectOnBackspace';\n\n/**\n * @see {@link withSelectOnBackspace}\n */\nexport const createSelectOnBackspacePlugin =\n  createPluginFactory<SelectOnBackspacePlugin>({\n    key: KEY_SELECT_ON_BACKSPACE,\n    withOverrides: withSelectOnBackspace,\n    options: {\n      removeNodeIfEmpty: false,\n    },\n  });\n"],"names":["withSelectOnBackspace","editor","options","query","removeNodeIfEmpty","deleteBackward","unit","selection","isCollapsed","pointBefore","getPointBefore","prevCell","getNodeEntries","match","node","queryNode","path","at","point","getPoint","selectedNode","getNode","getNodeString","removeNodes","select","KEY_SELECT_ON_BACKSPACE","createSelectOnBackspacePlugin","createPluginFactory","key","withOverrides"],"mappings":";;AAkBA;AACA;AACA;AACaA,MAAAA,qBAAqB,GAAGA,CAInCC,MAAS,EACT;AACEC,EAAAA,OAAO,EAAE;IAAEC,KAAK;AAAEC,IAAAA,iBAAAA;AAAkB,GAAA;AACU,CAAC,KAC9C;EACH,MAAM;AAAEC,IAAAA,cAAAA;AAAe,GAAC,GAAGJ,MAAM,CAAA;AAEjCA,EAAAA,MAAM,CAACI,cAAc,GAAIC,IAA6C,IAAK;IACzE,MAAM;AAAEC,MAAAA,SAAAA;AAAU,KAAC,GAAGN,MAAM,CAAA;IAE5B,IAAIK,IAAI,KAAK,WAAW,IAAIE,WAAW,CAACD,SAAS,CAAC,EAAE;AAClD,MAAA,MAAME,WAAW,GAAGC,cAAc,CAACT,MAAM,EAAEM,SAAS,EAAoB;AACtED,QAAAA,IAAAA;AACF,OAAC,CAAC,CAAA;AAEF,MAAA,IAAIG,WAAW,EAAE;AACf,QAAA,MAAM,CAACE,QAAQ,CAAC,GAAGC,cAAc,CAACX,MAAM,EAAE;AACxCY,UAAAA,KAAK,EAAGC,IAAI,IAAKC,SAAS,CAAC,CAACD,IAAI,EAAEL,WAAW,CAACO,IAAI,CAAC,EAAEb,KAAK,CAAC;AAC3Dc,UAAAA,EAAE,EAAER,WAAAA;AACN,SAAC,CAAC,CAAA;AAEF,QAAA,IAAI,CAAC,CAACE,QAAQ,IAAIF,WAAW,EAAE;AAC7B,UAAA,MAAMS,KAAK,GAAGC,QAAQ,CAAClB,MAAM,EAAEM,SAA2B,CAAC,CAAA;UAC3D,MAAMa,YAAY,GAAGC,OAAO,CAACpB,MAAM,EAAEiB,KAAK,CAACF,IAAI,CAAC,CAAA;UAChD,IACEZ,iBAAiB,IACjBgB,YAAY,IACZ,CAACE,aAAa,CAACF,YAAmB,CAAC,EACnC;AACA;YACAG,WAAW,CAACtB,MAAM,CAAC,CAAA;AACrB,WAAA;;AAEA;AACAuB,UAAAA,MAAM,CAACvB,MAAM,EAAEQ,WAAW,CAAC,CAAA;AAC7B,SAAC,MAAM;UACLJ,cAAc,CAACC,IAAI,CAAC,CAAA;AACtB,SAAA;AACF,OAAC,MAAM;QACLD,cAAc,CAACC,IAAI,CAAC,CAAA;AACtB,OAAA;AACF,KAAC,MAAM;MACLD,cAAc,CAACC,IAAI,CAAC,CAAA;AACtB,KAAA;GACD,CAAA;AAED,EAAA,OAAOL,MAAM,CAAA;AACf;;AC/DO,MAAMwB,uBAAuB,GAAG,oBAAmB;;AAE1D;AACA;AACA;AACaC,MAAAA,6BAA6B,GACxCC,mBAAmB,CAA0B;AAC3CC,EAAAA,GAAG,EAAEH,uBAAuB;AAC5BI,EAAAA,aAAa,EAAE7B,qBAAqB;AACpCE,EAAAA,OAAO,EAAE;AACPE,IAAAA,iBAAiB,EAAE,KAAA;AACrB,GAAA;AACF,CAAC;;;;"}