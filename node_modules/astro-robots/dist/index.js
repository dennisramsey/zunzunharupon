import x from"node:fs";var g="astro-robots";var c=class{colors={reset:"\x1B[0m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",cyanBold:"\x1B[1m\x1B[36m"}};packageName;constructor(r){this.packageName=r}log(r,o=""){let a=r.join(`
`),s=new Date,e=s.getHours().toString().padStart(2,"0"),n=s.getMinutes().toString().padStart(2,"0"),m=s.getSeconds().toString().padStart(2,"0"),f=`\x1B[2m${e}:${n}:${m}\x1B[22m`;console.log(`${f} %s[${this.packageName}]%s ${a}`,o,o?this.colors.reset:"")}info(...r){this.log(r,this.colors.fg.cyanBold)}success(...r){this.log(r,this.colors.fg.cyanBold)}warn(...r){this.log([`${this.colors.fg.yellow}(!)${this.colors.reset} ${r}`],this.colors.fg.cyanBold)}error(...r){this.log([`${this.colors.fg.red}failed!${this.colors.reset}`,...r],this.colors.fg.cyanBold)}};function u(t){let r=performance.now();t();let o=performance.now();return Math.floor(o-r)}var l=new c(g);function p(t){let r=/^(?=.{1,253}$)(?:(?!-)[a-zA-Z0-9-]{1,63}(?<!-)\.)+[a-zA-Z]{2,63}$/;typeof t!="string"&&i("Host must be a string","error"),r.test(t)||i("Host is invalid","error")}function h(t){let r="";return t.host===!0||t.host===!1||(typeof t.host=="number"?p(t.host):typeof t.host=="string"&&t.host!=="localhost"&&(p(t.host),r+=`Host: ${t.host}
`)),r}function b(t){/^https?:\/\/[^\s/$.?#].[^\s]*\.(xml|txt|html|xml.gz|txt.gz|json|xhtml)$/i.test(t)||i("sitemap [URL is invalid or not a valid sitemap file.]",!0)}function y(t,r){let o="";if(t.sitemap===!0)o+=`Sitemap: ${r}sitemap-index.xml
`;else if(typeof t.sitemap=="number")i("sitemap [URL is invalid or not a valid sitemap file.]",!0);else if(typeof t.sitemap=="string")b(t.sitemap),o+=`Sitemap: ${t.sitemap}
`;else if(Array.isArray(t.sitemap))for(let a of t.sitemap)b(a),o+=`Sitemap: ${a}
`;return o}function i(t,r){let o="\x1B[1mRefer:\x1B[22m",a=e=>{l.info("\x1B[31mFailured!\x1B[39m")},s=e=>{l.warn(`Skiped! [${e}].`)};switch(r){case"warn":s(t);break;case"error":throw a(t),new Error(`${t}`);case!0:throw a(t),new Error(`${t}
${o}
  Visit \x1B[4mhttps://developers.google.com/search/docs/crawling-indexing/robots/create-robots-txt#useful-robots.txt-rules\x1B[24m for instructions.`);default:throw a(t),new Error(`${t}
${o}
  Visit \x1B[4mhttps://yandex.com/support/webmaster/controlling-robot/robots-txt.html#recommend\x1B[24m for instructions.`)}}function w(t,r){var a;let o="";for(let s of t.policy??[]){if((a=t==null?void 0:t.policy)==null||a.forEach((e,n)=>{var m,f;e.userAgent||i(`policy[${n}].userAgent [Required, one or more per group].
${JSON.stringify(e,null,2)}`,!!e.userAgent),(!e.allow&&!e.disallow||((m=e.allow)==null?void 0:m.length)===0&&((f=e.disallow)==null?void 0:f.length)===0)&&i(`policy[${n}] [At least one or more 'disallow' or 'allow' entries per rule].
${JSON.stringify(e,null,2)}`,!e.allow&&!e.disallow),e.crawlDelay&&typeof e.crawlDelay!="number"?i(`policy[${n}].crawlDelay [Must be number].
${JSON.stringify(e,null,2)}`,!1):e.crawlDelay!==void 0&&(e==null?void 0:e.crawlDelay)<0?i(`policy[${n}].crawlDelay [Must be a positive number].
${JSON.stringify(e,null,2)}`,!1):e.crawlDelay!==void 0&&((e==null?void 0:e.crawlDelay)<.1||e.crawlDelay>60)&&i(`policy[${n}].crawlDelay [Must be between 0.1 and 60 seconds].
${JSON.stringify(e,null,2)}`,!1)}),s.userAgent){let e=Array.isArray(s.userAgent)?s.userAgent:[s.userAgent||"*"];for(let n of e)n&&(o+=`User-agent: ${n}
`)}if(s.allow){let e=Array.isArray(s.allow)?s.allow:[s.allow];for(let n of e)o+=`Allow: ${n}
`}if(s.disallow){let e=Array.isArray(s.disallow)?s.disallow:[s.disallow];for(let n of e)o+=`Disallow: ${n}
`}if(s.crawlDelay&&(o+=`Crawl-delay: ${s.crawlDelay}
`),s.cleanParam){let e=Array.isArray(s.cleanParam)?s.cleanParam:[s.cleanParam];for(let n of e)o+=`Clean-param: ${n}
`}t.policy&&s!==t.policy[t.policy.length-1]?o+=`
`:t.sitemap!==!1&&(o+=`
# crawling rule(s) for above bots
`)}return o+=y(t,r),o+=h(t),o}function d(t){t>10&&(console.log(`
\x1B[42m generating 'robots.txt' file \x1B[0m`),console.log(`${[`
\x1B[33m(!) Keep your 'robots.txt' file size under 10 KB for best crawling results.`,"- To keep it low, only include directives that are necessary for your site.",`- Remove rules for pages that no longer exist to avoid bloat.\x1B[0m
`].join(`
`)}`))}function $(t){return x.statSync(t).size/1024}var A={sitemap:!0,host:!1,policy:[{userAgent:"*",allow:"/"}]};function S(t){let r,o,a,s={...A,...t};return{name:g,hooks:{"astro:config:setup":({config:e})=>{r=e},"astro:build:start":()=>{o=new URL(r.base,r.site).href},"astro:build:done":async({dir:e})=>{a=u(()=>{x.writeFileSync(new URL("robots.txt",e),w(s,o),"utf-8")});let n=$(new URL("robots.txt",e));l.info(`\x1B[2mCompleted in ${a}ms\x1B[22m`),d(n),l.success(`\x1B[32mgenerated\x1B[0m 'robots.txt' ${n} KB`)}}}}export{S as default};
